(function(t){function e(e){for(var a,o,h=e[0],s=e[1],c=e[2],g=0,u=[];g<h.length;g++)o=h[g],n[o]&&u.push(n[o][0]),n[o]=0;for(a in s)Object.prototype.hasOwnProperty.call(s,a)&&(t[a]=s[a]);l&&l(e);while(u.length)u.shift()();return r.push.apply(r,c||[]),i()}function i(){for(var t,e=0;e<r.length;e++){for(var i=r[e],a=!0,h=1;h<i.length;h++){var s=i[h];0!==n[s]&&(a=!1)}a&&(r.splice(e--,1),t=o(o.s=i[0]))}return t}var a={},n={index:0},r=[];function o(e){if(a[e])return a[e].exports;var i=a[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,o),i.l=!0,i.exports}o.m=t,o.c=a,o.d=function(t,e,i){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(o.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)o.d(i,a,function(e){return t[e]}.bind(null,a));return i},o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="/";var h=window["webpackJsonp"]=window["webpackJsonp"]||[],s=h.push.bind(h);h.push=e,h=h.slice();for(var c=0;c<h.length;c++)e(h[c]);var l=s;r.push([0,"chunk-vendors"]),i()})({0:function(t,e,i){t.exports=i("c31f")},"42b1":function(t,e,i){"use strict";var a=i("880c"),n=i.n(a);n.a},"880c":function(t,e,i){},c31f:function(t,e,i){"use strict";i.r(e);i("cadf"),i("551c"),i("f751"),i("097d");var a=i("2b0e"),n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"app"}},[a("p",{staticClass:"operation"},[a("button",{on:{click:t.getImageData}},[t._v("点我截图")]),a("button",{on:{click:function(e){return t.crop.changeImage()}}},[t._v("点我换图")])]),a("p",{staticClass:"watermark"},[t._v("输入水印文字：\n    "),a("input",{directives:[{name:"model",rawName:"v-model",value:t.textWatermark,expression:"textWatermark"}],attrs:{type:"text",placeholder:"可以输入水印"},domProps:{value:t.textWatermark},on:{input:function(e){e.target.composing||(t.textWatermark=e.target.value)}}})]),a("p",{staticClass:"watermark"},[t._v("颜色\n    "),a("input",{directives:[{name:"model",rawName:"v-model",value:t.color,expression:"color"}],attrs:{type:"text",placeholder:"16进制颜色"},domProps:{value:t.color},on:{input:function(e){e.target.composing||(t.color=e.target.value)}}})]),a("crop",{staticStyle:{width:"100%",height:"560px","background-color":"#f1f3f5"},attrs:{position:["70%","70%",3,12],textWatermark:t.textWatermark,angle:45,color:t.color},model:{value:t.crop,callback:function(e){t.crop=e},expression:"crop"}},[a("template",{slot:"placeholder"},[a("img",{staticStyle:{width:"20%"},attrs:{src:"https://ss1.bdstatic.com/70cFvXSh_Q1YnxGkpoWK1HF6hhy/it/u=1057851374,249752393&fm=26&gp=0.jpg"}})]),a("template",{slot:"defaultImgUrl"},[a("img",{attrs:{src:i("ee59")}})])],2),t.cropAction?a("div",{staticStyle:{"text-align":"center"}},[a("p",[t._v("长按保存图片")]),t.cropAction?a("img",{staticStyle:{width:"70%"},attrs:{src:t.imageData,alt:""}}):t._e()]):t._e()],1)},r=[],o=(i("96cf"),i("3b8d")),h={name:"app",data:function(){return{color:"#f60",textWatermark:"板蓝根出品，必属精品",crop:{},cropAction:!1,imageData:null}},methods:{uploadImg:function(t){this.imgwatermark=this.imgae=t.target.files[0]},changeImg:function(t){this.isimg=!0,this.imgwatermark=t.target.files[0]},getImageData:function(){var t=Object(o["a"])(regeneratorRuntime.mark(function t(){var e;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.crop.getImage("Base64","image/png",2);case 2:e=t.sent,this.imageData=e,this.cropAction=!0;case 5:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}()}},s=h,c=(i("42b1"),i("2877")),l=Object(c["a"])(s,n,r,!1,null,null,null),g=l.exports,u=(i("7f7f"),function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{ref:"mountNode",staticClass:"mount-node",staticStyle:{overflow:"hidden"},on:{touchstart:function(e){return t.handleStart(e)},touchmove:function(e){return t.handleMove(e)}}},[i("div",{directives:[{name:"show",rawName:"v-show",value:t.noImage,expression:"noImage"}],staticClass:"no-image-file",staticStyle:{height:"100%",display:"flex","justify-content":"center","align-items":"center","flex-wrap":"wrap"},on:{click:t.inputHandle,touchstart:function(t){t.stopPropagation()},touchmove:function(t){t.stopPropagation()}}},[t._t("placeholder",[i("span",[t._v("暂时没有图片,请选择图像")])]),i("div",{staticStyle:{display:"none"}},[i("input",{attrs:{type:"file",id:"file-input",accept:"image/jpeg,image/x-icon,image/png"},on:{change:t.uploadImg}}),t._t("defaultImgUrl")],2)],2)])}),d=[],p=(i("6b54"),i("e814")),f=i.n(p),m=i("768b"),v=i("795b"),x=i.n(v),w=i("cebc"),y=(i("ac6a"),i("6c7b"),{name:"crop",props:["value","position","textWatermark","imageWatermark","defaultImgUrl","color","angle"],data:function(){return{noImage:!0,ctx:null,options:null,pixelRatio:null,scale:1,canvas:null,image:{},points:[],lines:[],cropper:{},startPoint:{},touchBar:{},nookSide:30,rotateAngle:0}},methods:{animation:function(t){if(t){var e=t.width,i=t.height,a=this.options,n=a.width,r=a.height,o=e,h=i,s=1;e>n&&(o=n,s=o/e,h=s*i),h>r&&(h=r,s=h/i,o=s*e);var c=100;e<c&&(o=c,s=o/e,h=s*i),h<c&&(h=c,s=h/i,o=s*e),this.image={element:t,width:o,height:h,x:(n-o)/2,y:(r-h)/2,clientWidth:e,clientHeight:i},this.cropper={x:(n-o/2)/2,y:(r-h/2)/2,width:o/2,height:h/2},this.touchBar={x:n-60-14,y:10,width:60,height:60},this.scale=s,this.draw()}},draw:function(){var t=this.options,e=t.width,i=t.height;this.ctx.clearRect(0,0,e,i),this.fillBackground(),this.fillImage(),this.averageColor||(this.averageColor=this.getImageColor(this.ctx.getImageData(this.cropper.x,this.cropper.y,50,50).data)),this.updatePoint(),this.fillCropper(),this.angle&&this.drawTouchBar()},drawTouchBar:function(){var t=this.ctx,e=this.touchBar,i=this.color||this.averageColor,a=e.x+.6*e.width,n=e.y+.64*e.height,r=.41*e.width,o=6,h=.1*e.width,s=.18*e.width;if(t.lineWidth=2,t.fillStyle=i,t.fillRect(a-e.width/6,n-e.height/6,.43*e.width,.43*e.height),t.strokeStyle=i,t.beginPath(),t.arc(a,n,r,Math.PI/180*180,-Math.PI/2+o,!1),t.stroke(),o<2*Math.PI){var c=a+(r-h)*Math.sin(o),l=n-(r-h)*Math.cos(o),g=a+(r+h)*Math.sin(o),u=n-(r+h)*Math.cos(o),d=(c+g)/2+s*Math.sin(o+Math.PI/2),p=(l+u)/2-s*Math.cos(o+Math.PI/2);t.beginPath(),t.moveTo(d,p),t.lineTo(c,l),t.lineTo(g,u),t.fill()}},fillImage:function(){var t=this.image,e=this.ctx,i=this.rotateAngle||0;this.canvasRotate("img",e,t.element,i,t.x,t.y,t.width,t.height)},updatePoint:function(){var t=this.cropper,e=this.nookSide,i=t.x+t.width,a=t.y+t.height,n=i-e,r=a-e;this.points=[{x:t.x,y:t.y,width:e,height:e,diffX:0,diffY:0},{x:n,y:t.y,width:e,height:e,diffX:e,diffY:0},{x:n,y:r,width:e,height:e,diffX:e,diffY:e},{x:t.x,y:r,width:e,height:e,diffX:0,diffY:e}];var o=e/.7/2,h=o/2;this.lines=[{x:t.x,y:t.y-h,width:t.width,height:o},{x:i-h,y:t.y,width:o,height:t.height},{x:t.x,y:a-h,width:t.width,height:o},{x:t.x-h,y:t.y,width:o,height:t.height}]},fillCropper:function(){var t=this.ctx,e=this.cropper,i=this.points,a=this.color||this.averageColor;t.strokeStyle=a,t.lineWidth=2,t.strokeRect(e.x,e.y,e.width,e.height),t.fillStyle=a;var n=this.nookSide/8;i.forEach(function(e,i){t.save(),t.translate(e.x+e.diffX,e.y+e.diffY),t.rotate(90*i*(Math.PI/180)),t.fillRect(-n,-n,e.height,2*n),t.fillRect(-n,-n,2*n,e.width),t.restore()})},fillBackground:function(){var t=this.options,e=t.width,i=t.height,a=this.ctx,n=30,r=Math.ceil(e/n),o=Math.ceil(i/n);a.save(),a.fillStyle="#ccc";for(var h=0;h<o;h++)for(var s=0;s<r;s++)(s+h)%2===0&&a.fillRect(s*n,h*n,n,n);a.fillStyle="rgba(0, 0, 0, .1)",a.fillRect(0,0,e,i),a.restore()},getNewCropper:function(t,e,i){return{cropperWidth:i.x+i.width-t,cropperHeight:i.y+i.height-e,cropperX:t-i.x,cropperY:e-i.y}},handlePointMove:function(t){var e=t.x,i=t.y,a=this.cropper,n={},r=this.getNewCropper(e,i,a),o=r.cropperWidth,h=r.cropperHeight,s=r.cropperX,c=r.cropperY;switch(this.index){case 0:n.width=o,n.height=h,n.x=e,n.y=i;break;case 1:n.width=s,n.height=h,n.y=i;break;case 3:n.width=o,n.height=c,n.x=e;break;case 2:n.width=s,n.height=c;break;default:break}this.renderCropper(n)},handleLineMove:function(t){var e=t.x,i=t.y,a=this.cropper,n={},r=this.getNewCropper(e,i,a),o=r.cropperWidth,h=r.cropperHeight,s=r.cropperX,c=r.cropperY;switch(this.index){case 3:n.width=o,n.x=e;break;case 0:n.height=h,n.y=i;break;case 1:n.width=s;break;case 2:n.height=c;break;default:break}this.renderCropper(n)},renderCropper:function(t){t.width<=4*this.nookSide||t.height<=4*this.nookSide||(this.cropper=Object(w["a"])({},this.cropper,t),this.draw())},handleImageMove:function(t){var e=t.x,i=t.y,a=this.startPoint;this.image.x=e-a.offsetX,this.image.y=i-a.offsetY,this.draw()},getCoordinateByEvent:function(t){var e=t.target.getBoundingClientRect(),i=t.touches[0],a={x:i.clientX-e.left,y:i.clientY-e.top},n=this.options,r=n.width,o=n.height;if(!(a.x<=2||a.y<=2||a.x>=r-2||a.y>=o-2))return a},handleStart:function(t){if(t.preventDefault(),t.touches.length>1)return this.startTouches=t.touches,void(this.startPoint.type=null);this.startPoint=this.getPointByCoordinate(this.getCoordinateByEvent(t))},handleMove:function(t){t.preventDefault();var e=t.touches;if(e.length>1){var i,a=this.image,n=this.startTouches,r=this.scale;i=this.getDistance(e[0],e[1])/this.getDistance(n[0],n[1]),i=i<1?1/(1+i/80):1+Math.abs(i)/160,i*=r,this.scale=this.limit(i,.02,4);var o=a.clientWidth*this.scale,h=a.clientHeight*this.scale;return this.image.x+=(a.width-o)/2,this.image.y+=(a.height-h)/2,this.image.width=o,this.image.height=h,void this.draw()}var s=this.startPoint.type;s&&this.getCoordinateByEvent(t)&&this[s](this.getCoordinateByEvent(t))},checkRegion:function(t,e,i){return t>i.x&&t<i.x+i.width&&e>i.y&&e<i.y+i.height},getPointByCoordinate:function(t){var e=this,i=t.x,a=t.y,n=this.image,r=this.touchBar,o={},h=0;return this.checkRegion(i,a,r)?(this.rotateAngle=(this.rotateAngle+this.angle)%360,this.draw()):this.points.some(function(t,n){return h=n,e.checkRegion(i,a,t)})?(o.type="handlePointMove",this.index=h):this.lines.some(function(t,n){return h=n,e.checkRegion(i,a,t)})?(o.type="handleLineMove",this.index=h):this.checkRegion(i,a,n)&&(o.offsetX=i-n.x,o.offsetY=a-n.y,o.type="handleImageMove"),o},getDistance:function(t,e){var i=e.pageX-t.pageX,a=e.pageY-t.pageY;return Math.sqrt(i*i+a*a)},limit:function(t,e,i){return t<e?e:t>i?i:t},getImage:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Base64",i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"image/jpeg",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(!this.noImage){var n=this.image,r=this.cropper,o=this.pixelRatio,h={Base64:function(t,e){return new x.a(function(i){i(t.toDataURL(e))})},Blob:function(t,e){return new x.a(function(i){t.toBlob(function(t){i(t)},e)})}},s=r.width*a,c=r.height*a;this.canvas||(this.canvas=document.createElement("canvas"),this.cCtx=this.canvas.getContext("2d"));var l=this.cCtx;this.canvas.width=s*o,this.canvas.height=c*o,l.scale(o,o),l.clearRect(0,0,s,c);var g=this.rotateAngle||0;return this.canvasRotate("img",l,n.element,g,(n.x-r.x)*a,(n.y-r.y)*a,n.width*a,n.height*a),new x.a(function(n,r){if(h[e]){var o=Object(m["a"])(t.position,4),g=o[0],u=void 0===g?"50%":g,d=o[1],p=void 0===d?"50%":d,v=o[2],x=void 0===v?1:v,w=o[3],y=void 0===w?0:w;if(t.imageWatermark){var b=new Image;return b.src=t.getFileSrc(t.imageWatermark),b.crossOrigin="anonymous",void(b.onload=function(){var r=b.width*x*a,o=b.height*x*a,g=(s-r)*f()(u)/100,d=(c-o)*f()(p)/100;t.canvasRotate("img",l,b,y,g,d,r,o),n(h[e](t.canvas,i))})}if(t.textWatermark){var k=t.limit(12*x,12,100);l.font=k+"px Georgia";var I=t.textWatermark,P=l.measureText(I).width,S=(s-1.031*P)*f()(u)/100,R=(c-2.82*k)*f()(p)/100;return l.fillStyle=t.color||t.averageColor,"#ffffff"===l.fillStyle&&(l.fillStyle="#000"),t.canvasRotate("text",l,I,y,S,R,P,k),void n(h[e](t.canvas,i))}n(h[e](t.canvas,i))}else r("type = Blob || Base64")})}},canvasRotate:function(t,e,i,a,n,r,o,h){e.save();var s=h/2,c=o/2;e.translate(n+c,r+s),e.rotate(Math.PI/180*a),"img"===t?e.drawImage(i,-c,-s,o,h):e.fillText(i,-c,-s),e.restore()},changeImage:function(t){this.noImage||(this.averageColor=null,t?this.createImage(t):this.inputHandle())},getPixelRatio:function(t){var e=t.backingStorePixelRatio||t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1;return(window.devicePixelRatio||1)/e},uploadImg:function(t){this.createImage(t.target.files[0]),this.noImage=!1},getFileSrc:function(t){return"[object File]"===Object.prototype.toString.call(t)&&(t=window.URL.createObjectURL(t)),t},createImage:function(t){var e=this,i=new Image;i.crossOrigin="anonymous",i.src=this.getFileSrc(t),i.onload=function(){e.animation(i)}},inputHandle:function(){document.getElementById("file-input").click()},getImageColor:function(t){if(this.color)return this.color;for(var e=0,i=0,a=0,n=50,r=0;r<n;r++)for(var o=0;o<n;o++)e+=t[4*(n*r+o)],i+=t[4*(n*r+o)+1],a+=t[4*(n*r+o)+2];return e/=n*n,i/=n*n,a/=n*n,e=Math.round(e),i=Math.round(i),a=Math.round(a),"rgba(".concat(255-e,", ").concat(255-i,", ").concat(255-a,", 1)")}},mounted:function(){var t=this.$refs.mountNode,e=t.clientWidth,i=t.clientHeight;this.options={width:e,height:i};var a=document.createElement("canvas");a.style.width=e+"px",a.style.height=i+"px",t.appendChild(a),this.ctx=a.getContext("2d");var n=this.pixelRatio=this.getPixelRatio(this.ctx);if(a.width=e*n,a.height=i*n,this.ctx.scale(n,n),this.defaultImgUrl||this.$slots.defaultImgUrl){var r=this.defaultImgUrl?this.defaultImgUrl:this.$slots.defaultImgUrl[0].data.attrs.src;this.createImage(r),this.noImage=!1}this.$emit("input",{getImage:this.getImage,changeImage:this.changeImage})}}),b=y,k=Object(c["a"])(b,u,d,!1,null,null,null),I=k.exports,P=function t(e){t.installed||(t.installed=!0,e.component(I.name,I))};"undefined"!==typeof window&&window.Vue&&P(window.Vue);var S={install:P,crop:I};a["a"].use(S),a["a"].config.productionTip=!1,new a["a"]({render:function(t){return t(g)}}).$mount("#app")},ee59:function(t,e,i){t.exports=i.p+"img/u=1388650196,3398819234&fm=26&gp=0.4bfbd4a3.jpg"}});
//# sourceMappingURL=index.68f7a0c5.js.map